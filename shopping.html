<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WingO Shopping & Points</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { background:#19181F; color:#fff; font-family:sans-serif; margin:0; }
    .container { max-width:420px; margin:32px auto; background:#232136; border-radius:24px; box-shadow:0 3px 20px #0005; padding:28px 18px 34px 18px; }
    h2 { color: #ffd900; text-align:center; margin-bottom:18px;}
    label { display:block; margin-top:16px; color:#ffe080; font-weight:600;}
    input, select { width:100%; padding:10px; margin-top:7px; margin-bottom:8px; border-radius:7px; border:none; font-size:1em;}
    button { width:100%; padding:13px; background: #ffd900; color:#232221; border:none; border-radius:8px; font-weight:800; font-size:1.13em; cursor:pointer; transition:.18s;}
    button:hover { background: #ffc300; }
    .info, .success, .error { display:block; margin-top:14px; }
    .info { color:#aad3fb;}
    .success { color:#24db53;}
    .error { color:#ed344d;}
    .section { margin-bottom:24px; padding-bottom:14px; border-bottom:1px solid #2d293a; }
    .section:last-child { border-bottom: none; }
  </style>
</head>
<body>
  <div class="container">

    <h2>ðŸ›’ WingO Shopping & Points</h2>

    <!-- User Info/Login/Register -->
    <div class="section">
      <form id="registerForm">
        <label>Email
          <input type="email" id="regEmail" required placeholder="Enter your email">
        </label>
        <label>Password
          <input type="password" id="regPassword" required placeholder="Password">
        </label>
        <label>Agent Reference Code (optional)
          <input type="text" id="regAgent" placeholder="Agent code (if any)">
        </label>
        <button type="submit">Register / Login</button>
        <span id="regMsg"></span>
      </form>
    </div>

    <!-- Buy Products Section -->
    <div class="section">
      <form id="productForm">
        <label>Buy Product:
          <select id="productSelect">
            <option value="mobilecase">Mobile Case â‚¹149</option>
            <option value="mug">Coffee Mug â‚¹249</option>
            <option value="winpoints">WinGo Points (Custom)</option>
          </select>
        </label>
        <div id="pointsSection" style="display:none;">
          <label>Enter Points to Purchase
            <input type="number" id="buyPoints" min="10" step="1" placeholder="100">
          </label>
        </div>
        <button type="submit">Buy Now</button>
        <span id="prodMsg"></span>
      </form>
    </div>
  </div>

  <script>
    // === CONFIG ===
    const gameApiUrl = "https://wingo-backend-nqk5.onrender.com"; // Change if needed
    // ENDPOINTS (adjust as needed for your product backend)
    // /api/users/register      (POST: {email, password, agentCode})
    // /api/users/wallet/recharge (POST: {amount})

    let token = localStorage.getItem('token') || null;

    // Registration/Login
    document.getElementById("registerForm").onsubmit = async function(e) {
      e.preventDefault();
      const regMsg = document.getElementById("regMsg");
      regMsg.textContent = "Processing...";
      regMsg.className = "info";
      try {
        const res = await fetch(gameApiUrl + "/api/users/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: document.getElementById("regEmail").value,
            password: document.getElementById("regPassword").value,
            agentCode: document.getElementById("regAgent").value || undefined
          })
        });
        const data = await res.json();
        if (res.ok && data.token) {
          regMsg.textContent = "Login/Registration successful!";
          regMsg.className = "success";
          token = data.token;
          localStorage.setItem('token', token);
        } else {
          regMsg.textContent = data.message || "Registration failed!";
          regMsg.className = "error";
        }
      } catch(err) {
        regMsg.textContent = "Registration error!";
        regMsg.className = "error";
      }
    };

    // Show/hide points input if "WinGo Points" selected
    document.getElementById('productSelect').addEventListener('change', function() {
      const show = this.value === 'winpoints';
      document.getElementById('pointsSection').style.display = show ? '' : 'none';
    });

    // Product Purchase Handler
    document.getElementById("productForm").onsubmit = async function(e) {
      e.preventDefault();
      const prodMsg = document.getElementById("prodMsg");
      prodMsg.textContent = "Placing order...";
      prodMsg.className = "info";
      if (!token) {
        prodMsg.textContent = "Please register/login first.";
        prodMsg.className = "error";
        return;
      }
      const product = document.getElementById('productSelect').value;
      if (product === "winpoints") {
        const points = parseInt(document.getElementById("buyPoints").value, 10) || 0;
        if (points < 1) {
          prodMsg.textContent = "Please enter minimum 1 point.";
          prodMsg.className = "error";
          return;
        }
        // Call backend to recharge wallet
        try {
          const res = await fetch(gameApiUrl + "/api/users/wallet/recharge", {
            method: "POST",
            headers: { "Authorization": "Bearer "+token, "Content-Type": "application/json" },
            body: JSON.stringify({ amount: points })
          });
          const data = await res.json();
          if (res.ok) {
            prodMsg.textContent = `Order Success! ${points} points added to your game wallet.`;
            prodMsg.className = "success";
          } else {
            prodMsg.textContent = data.message || "Points order failed!";
            prodMsg.className = "error";
          }
        } catch (err) {
          prodMsg.textContent = "Order error!";
          prodMsg.className = "error";
        }
      } else {
        // Simulate normal product order (like mobile case/mug)
        prodMsg.textContent = "Order placed for product (" + product + "). You will be contacted for delivery!";
        prodMsg.className = "success";
      }
    };
  </script>
</body>
</html>
